# Redish

## Start the app

### Frontend

To start the development server run `nx serve redish-frontend --open`. This will open your browser and navigate to http://localhost:4200/.

In case this error occurs: `Could not find ".modules.yaml" at "C:\TUD\source\web\redish-check\redish/node_modules/.modules.yaml"`, just create an empty file `.modules.yaml`. It is apparently a problem when using npm and pnpm in parallel.

To start host and remotes in dev mode, run `nx serve redish-frontend --open --devRemotes="games-worm"`. This will allow you to develop on your host app and your remotes simultaneously, instead of serving static versions of remotes from cache (as explained [here](https://github.com/nrwl/react-module-federation) for a similar setup).

### Backend

todo: add documentation for database

Copy `apps/redish-backend/example.env` to `apps/redish-backend/.env` and replace values to fit your configuration (at least `DATABASE_PASSWORD`).

To start the development server run `nx serve redish-backend`.

## Architecture

### Backend

#### Clean Architecture

Infrastructure > Use Cases > Domain

#### Result Pattern

As seen for example [here at Alex Dunn](https://alexdunn.org/2019/02/25/clean-up-your-client-to-business-logic-relationship-with-a-result-pattern-c/) or [here from Isaac Cummings](https://medium.com/@cummingsi1993/the-operation-result-pattern-a-simple-guide-fe10ff959080).

No proper definition found, but we want to prevent throwing exceptions.

### Frontend

#### Module federation

We are making use of [Nx | Module Federation Support](https://nx.dev/concepts/more-concepts/faster-builds-with-module-federation).

## Nx

Initially built via the nx workspace generator, `npx create-nx-workspace@latest npx create-nx-workspace@latest frontend --preset=react-monorepo`:

- app name redish
- bundler webpack
- no e2e test runners
- scss stylesheets
- no distributed caching (nx cloud)

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ✨

### Usage of Nx in redish

#### Enforcing Module Boundaries

We use nx feature `@nx/enforce-module-boundaries` to enforce module boundaries. It allows us to create rules on which libraries are allowed to import other libraries (see `.eslintrc.json`). Hereby we can enforce our architecture, as we divide layers into libraries. These rules are checked by the linter. By running the linter as a git pre-commit hook (`./husky/pre-commit`), we enforce the integrity of our architecture in every commit.

##### Example

```json
{
  "sourceTag": "type:usecases",
  "onlyDependOnLibsWithTags": ["type:usecases", "type:domain"]
},
{
  "sourceTag": "platform:server",
  "onlyDependOnLibsWithTags": ["platform:shared", "platform:server"]
},
```

A library tagged with `type:usecases` can only rely on other libraries tagged with `type:usecases` or `type:domain`. Simultaneously a library tagged with `platform:server` can only import libraries tagged with `platform:shared` (shared between frontend and backend) or `platform:server`. Thereby preventing imports from frontend libraries.

### Generate code

If you happen to use Nx plugins, you can leverage code generators that might come with it.

Run `nx list` to get a list of available plugins and whether they have generators. Then run `nx list <plugin-name>` to see what generators are available.

Learn more about [Nx generators on the docs](https://nx.dev/plugin-features/use-code-generators).

or at https://nx.dev/react-tutorial/1-code-generation.

#### Create module-federation host app

`nx generate @nx/react:host --name=redish-frontend --directory=apps/redish-frontend --e2eTestRunner=none --projectNameAndRootFormat=as-provided --style=scss --typescriptConfiguration=true --unitTestRunner=none --no-interactive`

#### Create module-federation remote app

`nx generate @nx/react:remote --name=games-worm --devServerPort=4301 --directory=apps/games/worm --host=redish-frontend --e2eTestRunner=none --projectNameAndRootFormat=as-provided --routing=true --style=scss --typescriptConfiguration=true --unitTestRunner=none --no-interactive`

#### Create backend app

`nx generate @nx/nest:application --name=redish-backend --frontendProject=redish-frontend --directory=apps/redish-backend --projectNameAndRootFormat=as-provided --strict=true --no-interactive`

#### Create lib

`nx generate @nx/react:library --name=games-ui --directory=libs/redish-frontend/games/ui --importPath=@redish-frontend/games-ui --projectNameAndRootFormat=as-provided --tags='"platform:web", "scope:games", "type:ui"' --no-interactive --dry-run`

#### Create component

`nx g @nx/react:component redish-header --project games-ui`

### Running tasks

To execute tasks with Nx use the following syntax:

```
nx <target> <project> <...options>
```

You can also run multiple targets:

```
nx run-many -t <target1> <target2>
```

..or add `-p` to filter specific projects

```
nx run-many -t <target1> <target2> -p <proj1> <proj2>
```

Targets can be defined in the `package.json` or `projects.json`. Learn more [in the docs](https://nx.dev/core-features/run-tasks).

Use linter like `nx run-many --target=lint --all`.

### Want better Editor Integration?

Have a look at the [Nx Console extensions](https://nx.dev/nx-console). It provides autocomplete support, a UI for exploring and running tasks & generators, and more! Available for VSCode, IntelliJ and comes with a LSP for Vim users.

### Ready to deploy?

Just run `nx build demoapp` to build the application. The build artifacts will be stored in the `dist/` directory, ready to be deployed.

### Set up CI!

Nx comes with local caching already built-in (check your `nx.json`). On CI you might want to go a step further.

- [Set up remote caching](https://nx.dev/core-features/share-your-cache)
- [Set up task distribution across multiple machines](https://nx.dev/core-features/distribute-task-execution)
- [Learn more how to setup CI](https://nx.dev/recipes/ci)
